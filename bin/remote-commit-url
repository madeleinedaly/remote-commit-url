#!/usr/bin/env node
'use strict';
const meow = require('meow');
const path = require('path');
const util = require('util');
const gitconfig = util.promisify(require('gitconfiglocal'));
const gitUrlParse = require('git-url-parse');
const remoteCommitUrl = require('..');

const defaults = {
  commit: 'HEAD',
  remote: 'origin',
  cwd: process.cwd(),
  gitDir: process.env.GIT_DIR || '.git',
};

const options = {
  help: `
Usage:
  $ remote-commit-url [<ref>] [<remote>] [--cwd <dir> --git-dir <dir>]

Arguments:
  commit        Git commit ref [default: HEAD]
  remote        Git remote [default: origin]

Options:
  --cwd         Path to git repository [default: .]
  --git-dir     $GIT_DIR [default: $GIT_DIR or .git]`,
  flags: {
    cwd: {type: 'string', default: defaults.cwd},
    gitDir: {type: 'string', default: defaults.gitDir},
  },
};

(async cli => {
  if (cli.flags.h) cli.showHelp(0);

  const result = await remoteCommitUrl({
    commit: cli.flags[0] || defaults.commit,
    remote: cli.flags[1] || defaults.remote,
    gitDir: cli.flags.gitDir,
    cwd: cli.flags.cwd === defaults.cwd
      ? defaults.cwd
      : path.resolve(defaults.cwd, cli.flags.cwd),
  });

  console.log(result);
})(meow(options));
/*
  Local Variables:
  mode: js2
  End:
*/
